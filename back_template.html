<!-- Back Template -->
{{FrontSide}}
<hr id="answer">
<div id="back" class="card" data='{{json_data}}'></div>

<script>
  var jsonData = JSON.parse(unescape(document.getElementById("back").getAttribute("data")));

  var titleContent = `<div class="word-title">
    <h1>${jsonData.japanese[0].word} (${jsonData.japanese[0].reading})</h1>`;

  // Process common word
  var commonWord = jsonData.is_common ? 'Common word' : '';

  // Process JLPT levels
  var jlptLevels = '';
  if (jsonData.jlpt && jsonData.jlpt.length > 0) {
    jlptLevels = `JLPT: ${jsonData.jlpt.map(level => level.toUpperCase().replace('JLPT-', '')).join(', ')}`;
  }

  // Process Wanikani level
  var wanikaniLevel = '';
  if (jsonData.tags && jsonData.tags.length > 0 && jsonData.tags[0].startsWith("wanikani")) {
    wanikaniLevel = `Wanikani level ${jsonData.tags[0].substr(8)}`;
  }

  // Combine processed parts
  var tagsContent = [commonWord, jlptLevels, wanikaniLevel].filter(Boolean).join(', ');

  titleContent += `<span class="tags">${tagsContent}</span>
  </div>`;


  // Definitions and details section
  var definitionsContent = '<div class="definitions">';
  jsonData.senses.forEach(function(sense, index) {

    // Skip if parts_of_speech includes "Wikipedia definition"
    if (sense.parts_of_speech.includes("Wikipedia definition")) {
      return;
    }

    definitionsContent += `<div class="definition">
      <div class="part-of-speech">${sense.parts_of_speech[0]}</div>
      <strong>${index + 1}. ${sense.english_definitions.join(', ')}</strong>`;
    if (sense.restrictions.length > 0) {
      definitionsContent += `<p>(Only applies to ${jsonData.japanese[0].reading})</p>`;
    }
    definitionsContent += `</div>`;
  });
  definitionsContent += '</div>';

  // Other forms and notes section
  var otherFormsContent = '';
  if (jsonData.japanese.length > 1) {
    var otherForms = jsonData.japanese.slice(1).map(j => `${j.word} [${j.reading}]`).join(', ');
    otherFormsContent = `<div class="other-forms">Other forms: ${otherForms}</div>`;
  }

  // Combining all parts into the final content
  var finalContent = `<div class="jisho-style">${titleContent}${definitionsContent}${otherFormsContent}</div>`;

  document.getElementById('back').innerHTML = finalContent;
</script>
